!function(){"use strict";class e{constructor(e="keyval-store",t="keyval"){this.storeName=t,this._dbp=new Promise((n,r)=>{const o=indexedDB.open(e,1);o.onerror=()=>r(o.error),o.onsuccess=()=>n(o.result),o.onupgradeneeded=()=>{o.result.createObjectStore(t)}})}_withIDBStore(e,t){return this._dbp.then(n=>new Promise((r,o)=>{const s=n.transaction(this.storeName,e);s.oncomplete=()=>r(),s.onabort=s.onerror=()=>o(s.error),t(s.objectStore(this.storeName))}))}}let t;function n(){return t||(t=new e),t}const r=()=>{const t=new e("hugo-highlighter-db","annotations-store");return{setInDb:(e,r)=>function(e,t,r=n()){return r._withIDBStore("readwrite",n=>{n.put(t,e)})}(e,r,t),getValueByKey:async e=>await function(e,t=n()){let r;return t._withIDBStore("readonly",t=>{r=t.get(e)}).then(()=>r.result)}(e,t),deleteValueByKey:async e=>await function(e,t=n()){return t._withIDBStore("readwrite",t=>{t.delete(e)})}(e,t),getAllKeys:async()=>await function(e=n()){const t=[];return e._withIDBStore("readonly",e=>{(e.openKeyCursor||e.openCursor).call(e).onsuccess=function(){this.result&&(t.push(this.result.key),this.result.continue())}}).then(()=>t)}(t),clearStore:async()=>await function(e=n()){return e._withIDBStore("readwrite",e=>{e.clear()})}(t)}},{getValueByKey:o}=r(),s=async()=>{const e=await o(window.location.pathname),t=document.querySelectorAll("#highlight-anchor p");for(const n of t){let t=n.innerText;e&&e.forEach(({text:e})=>{e.forEach(e=>{const n=t.indexOf(e),r=n+e.length;if(n>-1){const e=t.slice(0,n)+"<span class='highlight-text'>"+t.slice(n,r)+"</span>"+t.slice(r,t.length);t=e}})}),n.innerHTML=t}},{getValueByKey:a,setInDb:i}=r(),l=async()=>{const e=await a("selectedText"),t=window.location.pathname,n=await a(t);i(t,n?[...n,e]:[e]),await s()};var c=[()=>{const e=document.createElement("div");return e.innerHTML='\n        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>\n    ',e.addEventListener("click",l),e}];const d=()=>{const e=document.getElementById("highlight-anchor"),t=document.createElement("div"),n=(()=>{const e=document.createElement("div");return c.forEach(t=>{const n=t();n.addEventListener("mouseover",({currentTarget:e})=>e.style.background="#666"),n.addEventListener("mouseleave",({currentTarget:e})=>e.style.background="none"),n.style.padding="10px",n.style.cursor="pointer",n.style.borderRadius="5px",e.appendChild(n)}),e.style.display="flex",e})();return t.style.background="#dd6868",t.style.height="48px",t.style.position="absolute",t.style.display="none",t.style.borderRadius="5px",t.appendChild(n),e.appendChild(t),t},{setInDb:u}=r(),h=()=>{const e=d(),t=document.getElementById("highlight-anchor"),n=t=>{const{pageY:n,pageX:r}=t;e.style.top=n+"px",e.style.left=r+"px",setTimeout(()=>(e=>{const t=window.getSelection().toString(),n=t.split("\n").filter(e=>e.length>0);t?(u("selectedText",{type:"selectedText",text:n}),e.style.display="flex"):e.style.display="none"})(e),100)};t.addEventListener("touchend",n),t.addEventListener("mouseup",n)};(async()=>{h(),await s()})()}();
